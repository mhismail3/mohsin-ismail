/* =============================================================================
   PAGE TRANSITIONS - Staggered Cascade Animation
   Elegant sequential fade-in for page elements
   ============================================================================= */

/* ─────────────────────────────────────────────────────────────────────────────
   TRANSITION CONTAINER
   
   The wrapper itself has NO animation to avoid breaking the fixed header.
   Transform on ancestors breaks `position: fixed` descendants.
   Instead, we animate individual sections and content elements.
   
   FOUC Prevention:
   - .page-transition-init: Initial state, content hidden, waiting for mount
   - .app-transition-ready: Animations trigger, content fades in
   ───────────────────────────────────────────────────────────────────────────── */

.page-transition {
  /* No animation on container - children animate individually.
     Minimal property to satisfy linting (empty rulesets are invalid). */
  contain: layout;
}

/* ─────────────────────────────────────────────────────────────────────────────
   UNIFIED ANIMATION SYSTEM
   
   ARCHITECTURE:
   Both header and content animations are triggered by a SINGLE class on their
   common parent (.app). This guarantees perfect synchronization because:
   
   1. One class change (.app-transition-init → .app-transition-ready)
   2. Both animations reference this parent class
   3. No timing differences between separate component re-renders
   
   The .app div gets app-transition-init/app-transition-ready from AppContent
   component, which reads isReady from PageTransitionContext.
   
   HEADER:
   Lives OUTSIDE PageTransition to avoid remounting, but its animation is
   triggered via the parent .app class, not its own state.
   
   CONTENT:
   Lives INSIDE PageTransition. The key={pathname} causes remounting, but
   animations only start when the parent .app class changes.
   ───────────────────────────────────────────────────────────────────────────── */

/* Header hidden during init phase - controlled via parent .app class.
   IMPORTANT: Initial state must match animation's 0% keyframe exactly
   to prevent visual jump when animation begins. */
.app-transition-init .top-bar {
  opacity: 0;
  /* iOS Safari: prefer translate3d for more reliable compositor behavior */
  transform: translate3d(0, 10px, 0);
  /* Prevent interaction while hidden */
  pointer-events: none;
  /* Encourage Safari to keep the header on its own layer */
  will-change: opacity, transform;
}

/* Header animates in sync with content - both triggered by same parent class.
   This ensures truly identical animation timing. */
.app-transition-ready .top-bar {
  /* Avoid keyframe animations on fixed + backdrop-filter (glitches on iOS Safari).
     Use transitions on opacity/transform instead; still triggered by the same
     .app class flip, so cadence stays unified with the content. */
  opacity: 1;
  transform: translate3d(0, 0, 0);
  /* Re-enable interaction */
  pointer-events: auto;
  will-change: auto;
}

/* Override pointer-events for collapsed state (handled by collapsed styles) */
.app-transition-ready .top-bar.collapsed {
  pointer-events: none;
}

/* Reduced motion: simple quick fade, still unified */
@media (prefers-reduced-motion: reduce) {
  .app-transition-init .top-bar {
    opacity: 0;
  }
  
  .app-transition-ready .top-bar {
    opacity: 1;
    transform: none;
  }
}

/* ─────────────────────────────────────────────────────────────────────────────
   INITIAL STATE (Before animations are ready)
   
   Hide all animatable content immediately. This prevents the flash where
   content briefly appears before animations kick in.
   
   IMPORTANT: Initial state must match animation's 0% keyframe exactly
   (opacity: 0, transform: translateY(10px)) to prevent visual jump.
   
   Uses .app-transition-init as the trigger (shared with header) to ensure
   both header and content are hidden/shown from the same source of truth.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-init .frame > section,
.app-transition-init .frame > article,
.app-transition-init .post-list > article,
.app-transition-init .moodboard-column,
.app-transition-init .moodboard-column .project-card,
.app-transition-init .about-content > *,
.app-transition-init .featured-project-card,
.app-transition-init .post-page .post-page-head,
.app-transition-init .post-page .post-body,
.app-transition-init .post-page .post-tags,
.app-transition-init .post-page .post-footer,
.app-transition-init .project-page .project-hero,
.app-transition-init .project-page .project-content,
.app-transition-init .panel-head,
.app-transition-init .filter-row .tag-cloud .pill {
  opacity: 0;
  transform: translateY(10px);
}

/* ─────────────────────────────────────────────────────────────────────────────
   STAGGER ANIMATION KEYFRAME
   
   Subtle fade + lift effect. Transform is safe here because we apply it
   to sibling elements of the header, not ancestors.
   ───────────────────────────────────────────────────────────────────────────── */

@keyframes staggerFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Simple fade for elements where transform might cause issues */
@keyframes simpleFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ─────────────────────────────────────────────────────────────────────────────
   SECTION-LEVEL STAGGER
   
   Each major section/panel fades in sequentially.
   Animations only trigger when .app-transition-ready is applied (shared parent).
   
   TIMING COORDINATION:
   - Header and first section start together at 0s for unified column feel
   - Subsequent sections have minimal stagger (50ms) for subtle depth
   - All use same duration and easing for visual cohesion
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .frame > section,
.app-transition-ready .frame > article {
  animation: staggerFadeIn 0.32s ease-in-out both;
}

/* First section syncs with header (0s delay) for unified entrance
   Subsequent sections have minimal stagger for subtle layering */
.app-transition-ready .frame > section:nth-of-type(1),
.app-transition-ready .frame > article:nth-of-type(1) { animation-delay: 0s; }

.app-transition-ready .frame > section:nth-of-type(2),
.app-transition-ready .frame > article:nth-of-type(2) { animation-delay: 0.05s; }

.app-transition-ready .frame > section:nth-of-type(3),
.app-transition-ready .frame > article:nth-of-type(3) { animation-delay: 0.10s; }

.app-transition-ready .frame > section:nth-of-type(4),
.app-transition-ready .frame > article:nth-of-type(4) { animation-delay: 0.15s; }

.app-transition-ready .frame > section:nth-of-type(5),
.app-transition-ready .frame > article:nth-of-type(5) { animation-delay: 0.20s; }

/* ─────────────────────────────────────────────────────────────────────────────
   PORTFOLIO MOODBOARD STAGGER
   
   Moodboard columns animate in sequence (left to right).
   Tighter stagger for unified feel with header.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .moodboard-column {
  animation: staggerFadeIn 0.32s ease-in-out both;
}

.app-transition-ready .moodboard-column:nth-child(1) { animation-delay: 0s; }
.app-transition-ready .moodboard-column:nth-child(2) { animation-delay: 0.04s; }
.app-transition-ready .moodboard-column:nth-child(3) { animation-delay: 0.08s; }

/* Project cards within moodboard columns */
.app-transition-ready .moodboard-column .project-card {
  animation: staggerFadeIn 0.32s ease-in-out both;
}

.app-transition-ready .moodboard-column:nth-child(1) .project-card:nth-child(1) { animation-delay: 0.02s; }
.app-transition-ready .moodboard-column:nth-child(1) .project-card:nth-child(2) { animation-delay: 0.06s; }
.app-transition-ready .moodboard-column:nth-child(1) .project-card:nth-child(3) { animation-delay: 0.10s; }

.app-transition-ready .moodboard-column:nth-child(2) .project-card:nth-child(1) { animation-delay: 0.05s; }
.app-transition-ready .moodboard-column:nth-child(2) .project-card:nth-child(2) { animation-delay: 0.09s; }
.app-transition-ready .moodboard-column:nth-child(2) .project-card:nth-child(3) { animation-delay: 0.13s; }

.app-transition-ready .moodboard-column:nth-child(3) .project-card:nth-child(1) { animation-delay: 0.08s; }
.app-transition-ready .moodboard-column:nth-child(3) .project-card:nth-child(2) { animation-delay: 0.12s; }
.app-transition-ready .moodboard-column:nth-child(3) .project-card:nth-child(3) { animation-delay: 0.16s; }

/* ─────────────────────────────────────────────────────────────────────────────
   ABOUT PAGE CONTENT STAGGER
   
   About content paragraphs and gallery animate in sequence.
   Tighter stagger for unified feel with header.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .about-content > * {
  animation: staggerFadeIn 0.32s ease-in-out both;
}

.app-transition-ready .about-content > *:nth-child(1) { animation-delay: 0s; }
.app-transition-ready .about-content > *:nth-child(2) { animation-delay: 0.04s; }
.app-transition-ready .about-content > *:nth-child(3) { animation-delay: 0.08s; }
.app-transition-ready .about-content > *:nth-child(4) { animation-delay: 0.12s; }
.app-transition-ready .about-content > *:nth-child(5) { animation-delay: 0.16s; }

/* ─────────────────────────────────────────────────────────────────────────────
   FEATURED PROJECT (Home Page)
   
   The featured project card on the home page.
   Syncs with header and content.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .featured-project-card {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0.05s;
}

/* ─────────────────────────────────────────────────────────────────────────────
   POST PAGE CONTENT
   
   The article content on individual post pages.
   Syncs with header (0s delay for first element), minimal stagger for rest.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .post-page .post-page-head {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0s;
}

.app-transition-ready .post-page .post-body {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0.05s;
}

.app-transition-ready .post-page .post-tags {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0.10s;
}

.app-transition-ready .post-page .post-footer {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0.15s;
}

/* ─────────────────────────────────────────────────────────────────────────────
   PROJECT PAGE CONTENT
   
   The project detail page elements.
   Syncs with header (0s delay for first element), minimal stagger for rest.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .project-page .project-hero {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0s;
}

.app-transition-ready .project-page .project-content {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0.05s;
}

/* ─────────────────────────────────────────────────────────────────────────────
   PANEL HEADERS
   
   Panel headers (eyebrow + title) animate with the same unified timing.
   Uses same animation as content for visual consistency.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .panel-head {
  animation: staggerFadeIn 0.32s ease-in-out both;
  animation-delay: 0s;
}

/* ─────────────────────────────────────────────────────────────────────────────
   TAG CLOUD STAGGER
   
   Filter tags animate with slight stagger.
   Tighter timing for unified entrance with header and content.
   ───────────────────────────────────────────────────────────────────────────── */

.app-transition-ready .filter-row .tag-cloud .pill {
  animation: staggerFadeIn 0.32s ease-in-out both;
}

.app-transition-ready .filter-row .tag-cloud .pill:nth-child(1) { animation-delay: 0.08s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(2) { animation-delay: 0.09s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(3) { animation-delay: 0.10s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(4) { animation-delay: 0.11s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(5) { animation-delay: 0.12s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(6) { animation-delay: 0.13s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(7) { animation-delay: 0.14s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(8) { animation-delay: 0.15s; }
.app-transition-ready .filter-row .tag-cloud .pill:nth-child(n+9) { animation-delay: 0.16s; }

/* ─────────────────────────────────────────────────────────────────────────────
   REDUCED MOTION
   
   Respect user preferences - simple fade only, no transforms.
   ───────────────────────────────────────────────────────────────────────────── */

@media (prefers-reduced-motion: reduce) {
  .app-transition-ready .frame > section,
  .app-transition-ready .frame > article,
  .app-transition-ready .moodboard-column,
  .app-transition-ready .moodboard-column .project-card,
  .app-transition-ready .about-content > *,
  .app-transition-ready .featured-project-card,
  .app-transition-ready .post-page .post-page-head,
  .app-transition-ready .post-page .post-body,
  .app-transition-ready .post-page .post-tags,
  .app-transition-ready .post-page .post-footer,
  .app-transition-ready .project-page .project-hero,
  .app-transition-ready .project-page .project-content,
  .app-transition-ready .panel-head,
  .app-transition-ready .filter-row .tag-cloud .pill {
    animation: simpleFadeIn 0.2s ease both;
    animation-delay: 0s;
  }
}
